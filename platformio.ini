[env:atoms3r-arduino]
# 采纳官方示例的 platform 版本，保证稳定性
platform = espressif32@6.3.2

# 板子定义保持不变
board = esp32-s3-devkitc-1
framework = espidf

monitor_speed = 115200

# 关键：采纳官方的内存类型配置，以正确驱动 Octal PSRAM
board_build.arduino.memory_type = qio_opi

# 合并 build_flags，加入官方推荐的关键修复和调试标志
build_flags =
    -DARDUINO_USB_MODE=1
    -DARDUINO_USB_CDC_ON_BOOT=1
    -mfix-esp32-psram-cache-issue
    -DCORE_DEBUG_LEVEL=5
    -DUSB_CDC_ON_BOOT=1

# 合并 lib_deps，使用新的 M5Unified 库，并保留你的项目所需库
lib_deps =
    # 切换到官方推荐的统一库
    M5Unified = https://github.com/m5stack/M5Unified

    # 你项目原有的库
    painlessmesh/painlessMesh
    knolleary/PubSubClient
    bblanchon/ArduinoJson